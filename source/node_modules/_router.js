// STACK
var h       = require('virtual-hyperscript-hook')(require('virtual-dom/h'))
var jss     = require('jss')
var css2jss = require('jss-cli/lib/cssToJss')
var routes  = require('routes')
// CUSTOM
var Header  = require('_header')
var Content = require('_content')
var Footer  = require('_footer')

var ROUTER

// STANDARD INTERFACE ???
// module.exports = function (req, res, params) {
//     res.end('beep boop\n');
// };
// and then in the server.js I can do:
//
// router.addRoute('/whatever', require('./lib/someroute.js'));

// VS.

// state && state.route
// ??

// &&

// // e.g.
// ./SOURCE/node_modules/_router/index.js
// ./SOURCE/node_modules/_router/someroute.js
// ./SOURCE/node_modules/_router/...

// module.exports = function (msg) {
//     return function (req, res, params) {
//         res.end(msg + '\n');
//     };
// };
// and then in server.js:
//
// router.addRoute('/whatever', require('./lib/someroute.js')('beep boop'));

module.exports = function _router (state) {
  if (!ROUTER) {
    ROUTER        = routes()
    var hHeader   = Header(state)
    var hContent  = Content(state)
    var hFooter   = Footer(state)

    var sheet  = jss.create().createStyleSheet(css2jss(`
      .banner {
        display           : flex;
        align-items       : center;
        justify-content   : center;
        background-color  : grey;
        font-size         : 50px;
        height            : 300px;
      }
    `),{ named: true, link: true }).attach()
    function s (name, modifier) {
      modifier = modifier ? '  ' + sheet.classes[modifier] : ''
      name     = sheet.classes[name]
      return name + modifier
    }

    ROUTER.addRoute('/', function (state) {
      return h('div', [
        hHeader(state),
        hContent(state),
        hFooter(state)
      ])
    })
    ROUTER.addRoute('/#products', function (state) {
      return h('div', [
        hHeader(state),
        hContent(state),
        hFooter(state)
      ])
    })
    ROUTER.addRoute('/a', function (state) {
      return h('div', { className: s('.products') }, [
        '<products>'
      ])
    })
  }
  return ROUTER
}
